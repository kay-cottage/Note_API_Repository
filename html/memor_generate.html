<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êô∫ËÉΩÁ¨îËÆ∞Êï¥ÁêÜÂ∑•ÂÖ∑</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .main-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #374151;
            margin-bottom: 20px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select, .form-group textarea {
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .password-input {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            color: #6b7280;
            font-size: 1.2rem;
        }

        .btn {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .btn-secondary:hover {
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-ready { background: #10b981; }
        .status-processing { background: #f59e0b; animation: pulse 2s infinite; }
        .status-error { background: #ef4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .log-container {
            background: #1f2937;
            color: #e5e7eb;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid #374151;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            border-left: 4px solid transparent;
        }

        .log-info { border-left-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
        .log-success { border-left-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .log-warning { border-left-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .log-error { border-left-color: #ef4444; background: rgba(239, 68, 68, 0.1); }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            transition: width 0.3s ease;
            width: 0%;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid rgba(99, 102, 241, 0.1);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #6366f1;
            display: block;
        }

        .stat-label {
            color: #6b7280;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2rem; }
            .main-content { padding: 20px; }
            .section { padding: 20px; }
            .form-grid { grid-template-columns: 1fr; }
        }

        .icon {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Êô∫ËÉΩÁ¨îËÆ∞Êï¥ÁêÜÂ∑•ÂÖ∑</h1>
            <p>Âü∫‰∫éAIÁöÑGitHubÁ¨îËÆ∞ËØ≠‰πâÁ¥¢Âºï‰∏éËá™Âä®Êï¥ÁêÜÁ≥ªÁªü</p>
        </div>

        <div class="main-content">
            <!-- ÈÖçÁΩÆÂå∫Âüü -->
            <div class="section">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    APIÈÖçÁΩÆ
                </h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="githubToken">GitHub API Token</label>
                        <div class="password-input">
                            <input type="password" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxx">
                            <button type="button" class="password-toggle" onclick="togglePassword('githubToken')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="openaiKey">OpenAI API Key</label>
                        <div class="password-input">
                            <input type="password" id="openaiKey" placeholder="sk-xxxxxxxxxxxxxxxx">
                            <button type="button" class="password-toggle" onclick="togglePassword('openaiKey')">üëÅÔ∏è</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="githubUser">GitHubÁî®Êà∑Âêç</label>
                        <input type="text" id="githubUser" placeholder="your-username">
                    </div>
                    <div class="form-group">
                        <label for="sourceRepo">Ê∫ê‰ªìÂ∫ìÂêç</label>
                        <input type="text" id="sourceRepo" placeholder="notes-repo">
                    </div>
                    <div class="form-group">
                        <label for="targetRepo">ÁõÆÊ†á‰ªìÂ∫ìÂêç</label>
                        <input type="text" id="targetRepo" placeholder="organized-notes-repo">
                    </div>
                    <div class="form-group">
                        <label for="gptModel">GPTÊ®°Âûã</label>
                        <select id="gptModel">
                            <option value="gpt-4o-mini">GPT-4o Mini (Êé®Ëçê)</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                    </div>
                </div>
                <button class="btn" onclick="saveConfig()" style="margin-top: 20px;">
                    üíæ ‰øùÂ≠òÈÖçÁΩÆ
                </button>
            </div>

            <!-- Êìç‰ΩúÂå∫Âüü -->
            <div class="section">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                    </svg>
                    Êô∫ËÉΩÊï¥ÁêÜÊéßÂà∂
                </h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                    <button class="btn btn-secondary" onclick="startProcessing()" id="processBtn">
                        üöÄ ÂºÄÂßãÊô∫ËÉΩÊï¥ÁêÜ
                    </button>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span class="status-indicator status-ready" id="statusIndicator"></span>
                        <span id="statusText">Â∞±Áª™</span>
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressBar"></div>
                </div>
            </div>

            <!-- ÁªüËÆ°Âå∫Âüü -->
            <div class="section">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                    </svg>
                    Â§ÑÁêÜÁªüËÆ°
                </h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="totalFiles">0</span>
                        <div class="stat-label">ÊÄªÊñá‰ª∂Êï∞</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="processedFiles">0</span>
                        <div class="stat-label">Â∑≤Â§ÑÁêÜ</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="skippedFiles">0</span>
                        <div class="stat-label">Â∑≤Ë∑≥Ëøá</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="errorFiles">0</span>
                        <div class="stat-label">Â§ÑÁêÜÂ§±Ë¥•</div>
                    </div>
                </div>
            </div>

            <!-- Êó•ÂøóÁÆ°ÁêÜÂå∫Âüü -->
            <div class="section">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    Êó•ÂøóÁÆ°ÁêÜ
                </h2>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="btn" onclick="viewHistoryLogs()" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
                        üìö Êü•ÁúãÂéÜÂè≤Êó•Âøó
                    </button>
                    <button class="btn" onclick="saveCurrentSession()" style="background: linear-gradient(135deg, #10b981, #059669);">
                        üíæ ‰øùÂ≠òÂΩìÂâç‰ºöËØù
                    </button>
                    <button class="btn" onclick="clearCurrentLogs()" style="background: linear-gradient(135deg, #6b7280, #4b5563);">
                        üóëÔ∏èÊ∏ÖÁ©∫ÂΩìÂâçÊó•Âøó
                    </button>
                </div>
                <div class="log-container" id="logContainer">
                    <div class="log-entry log-info">Á≥ªÁªüÂ∑≤Â∞±Áª™ÔºåÁ≠âÂæÖÂºÄÂßãÂ§ÑÁêÜ...</div>
                </div>
            </div>

            <!-- Â§ÑÁêÜÊó•Âøó -->
            <div class="section">
                <h2>
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                    </svg>
                    GitHubÊó•ÂøóÁä∂ÊÄÅ
                </h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-number" id="logStatus">üìù</span>
                        <div class="stat-label">Êó•ÂøóÁä∂ÊÄÅ</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="sessionCount">0</span>
                        <div class="stat-label">ÂéÜÂè≤‰ºöËØù</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number" id="errorCount">0</span>
                        <div class="stat-label">ÈîôËØØËÆ∞ÂΩï</div>
                    </div>
                    <div class="stat-card" style="cursor: pointer;" onclick="exportReport()">
                        <span class="stat-number">üìä</span>
                        <div class="stat-label">ÂØºÂá∫Êä•Âëä</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÂèòÈáè
        let config = {};
        let isProcessing = false;
        let processedLog = new Set();
        let stats = {
            total: 0,
            processed: 0,
            skipped: 0,
            error: 0
        };

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
        });

        // ÈÖçÁΩÆÁÆ°ÁêÜ
        function saveConfig() {
            config = {
                githubToken: document.getElementById('githubToken').value,
                openaiKey: document.getElementById('openaiKey').value,
                githubUser: document.getElementById('githubUser').value,
                sourceRepo: document.getElementById('sourceRepo').value,
                targetRepo: document.getElementById('targetRepo').value,
                gptModel: document.getElementById('gptModel').value
            };

            // ‰øùÂ≠òÂà∞ÂÜÖÂ≠òÔºà‰∏ç‰ΩøÁî®localStorageÔºâ
            addLog('ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
        }

        function loadConfig() {
            // ‰ªéÂÜÖÂ≠òÂä†ËΩΩÈÖçÁΩÆÔºàÂ¶ÇÊûúÊúâÁöÑËØùÔºâ
            if (Object.keys(config).length > 0) {
                document.getElementById('githubToken').value = config.githubToken || '';
                document.getElementById('openaiKey').value = config.openaiKey || '';
                document.getElementById('githubUser').value = config.githubUser || '';
                document.getElementById('sourceRepo').value = config.sourceRepo || '';
                document.getElementById('targetRepo').value = config.targetRepo || '';
                document.getElementById('gptModel').value = config.gptModel || 'gpt-4o-mini';
            }
        }

        function togglePassword(fieldId) {
            const field = document.getElementById(fieldId);
            const button = field.nextElementSibling;
            
            if (field.type === 'password') {
                field.type = 'text';
                button.textContent = 'üôà';
            } else {
                field.type = 'password';
                button.textContent = 'üëÅÔ∏è';
            }
        }

        // Êó•ÂøóÁÆ°ÁêÜ
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Áä∂ÊÄÅÁÆ°ÁêÜ
        function updateStatus(text, status = 'ready') {
            document.getElementById('statusText').textContent = text;
            const indicator = document.getElementById('statusIndicator');
            indicator.className = `status-indicator status-${status}`;
        }

        function updateProgress(percent) {
            document.getElementById('progressBar').style.width = `${percent}%`;
        }

        function updateStats() {
            document.getElementById('totalFiles').textContent = stats.total;
            document.getElementById('processedFiles').textContent = stats.processed;
            document.getElementById('skippedFiles').textContent = stats.skipped;
            document.getElementById('errorFiles').textContent = stats.error;
        }

        // GitHub APIË∞ÉÁî®
        async function githubRequest(endpoint, method = 'GET', body = null) {
            const url = `https://api.github.com${endpoint}`;
            const headers = {
                'Authorization': `token ${config.githubToken}`,
                'Accept': 'application/vnd.github.v3+json',
                'Content-Type': 'application/json'
            };

            const response = await fetch(url, {
                method,
                headers,
                body: body ? JSON.stringify(body) : null
            });

            if (!response.ok) {
                throw new Error(`GitHub API Error: ${response.status} ${response.statusText}`);
            }

            return await response.json();
        }

        // OpenAI APIË∞ÉÁî®
        async function openaiRequest(messages, model = 'gpt-4o-mini') {
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${config.openaiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: model,
                    messages: messages,
                    temperature: 0.7,
                    max_tokens: 4000
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API Error: ${response.status} ${response.statusText}`);
            }

            return await response.json();
        }

        // Ëé∑ÂèñÂ§ÑÁêÜÊó•Âøó
        async function getProcessingLog() {
            try {
                const logFile = await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/processing_log.md`);
                const content = atob(logFile.content);
                return content.split('\n').filter(line => line.trim());
            } catch (error) {
                if (error.message.includes('404')) {
                    return []; // Êó•ÂøóÊñá‰ª∂‰∏çÂ≠òÂú®
                }
                throw error;
            }
        }

        // Êõ¥Êñ∞Â§ÑÁêÜÊó•Âøó
        async function updateProcessingLog(filename, status = 'success', details = '') {
            const timestamp = new Date().toISOString();
            const logEntry = `${filename} | ${status} | ${timestamp} | ${details}`;
            
            try {
                const logFile = await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/processing_log.md`);
                const existingContent = atob(logFile.content);
                const newContent = existingContent + '\n' + logEntry;
                
                await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/processing_log.md`, 'PUT', {
                    message: `Update processing log for ${filename}`,
                    content: btoa(newContent),
                    sha: logFile.sha
                });
            } catch (error) {
                if (error.message.includes('404')) {
                    // ÂàõÂª∫Êñ∞ÁöÑÊó•ÂøóÊñá‰ª∂ÂíåÁõÆÂΩï
                    const logHeader = `# AIÁ¨îËÆ∞Êï¥ÁêÜÂ§ÑÁêÜÊó•Âøó\n\nËÆ∞ÂΩïÊ†ºÂºèÔºöÊñá‰ª∂Âêç | Áä∂ÊÄÅ | Êó∂Èó¥Êà≥ | ËØ¶ÁªÜ‰ø°ÊÅØ\n\n---\n\n`;
                    await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/processing_log.md`, 'PUT', {
                        message: `Create processing log directory and file`,
                        content: btoa(logHeader + logEntry)
                    });
                } else {
                    throw error;
                }
            }
        }

        // ÂÜôÂÖ•‰ºöËØùÊó•ÂøóÂà∞GitHub
        async function writeSessionLogToGithub() {
            const sessionId = Date.now();
            const sessionLog = Array.from(document.querySelectorAll('.log-entry')).map(el => el.textContent).join('\n');
            
            const sessionLogContent = `# AIÁ¨îËÆ∞Êï¥ÁêÜ‰ºöËØùÊó•Âøó - ${new Date().toLocaleString()}\n\n## ‰ºöËØùID: ${sessionId}\n\n## ÈÖçÁΩÆ‰ø°ÊÅØ\n- Ê®°Âûã: ${config.gptModel}\n- Ê∫ê‰ªìÂ∫ì: ${config.sourceRepo}\n- ÁõÆÊ†á‰ªìÂ∫ì: ${config.targetRepo}\n\n## Â§ÑÁêÜÁªüËÆ°\n- ÊÄªÊñá‰ª∂Êï∞: ${stats.total}\n- Â∑≤Â§ÑÁêÜ: ${stats.processed}\n- Â∑≤Ë∑≥Ëøá: ${stats.skipped}\n- Â§ÑÁêÜÂ§±Ë¥•: ${stats.error}\n\n## ËØ¶ÁªÜÊó•Âøó\n\n\`\`\`\n${sessionLog}\n\`\`\`\n\n---\n\nÁîüÊàêÊó∂Èó¥: ${new Date().toISOString()}`;
            
            try {
                await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/session_${sessionId}.md`, 'PUT', {
                    message: `Add session log ${sessionId}`,
                    content: btoa(sessionLogContent)
                });
                
                addLog(`üìù ‰ºöËØùÊó•ÂøóÂ∑≤‰øùÂ≠òÂà∞GitHub: logs/session_${sessionId}.md`, 'success');
                return true;
            } catch (error) {
                addLog(`‚ùå ‰øùÂ≠ò‰ºöËØùÊó•ÂøóÂ§±Ë¥•: ${error.message}`, 'error');
                return false;
            }
        }

        // Ëé∑ÂèñÂéÜÂè≤‰ºöËØùÊó•ÂøóÂàóË°®
        async function getSessionLogs() {
            try {
                const logsDir = await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs`);
                const sessionLogs = logsDir.filter(file => file.name.startsWith('session_') && file.name.endsWith('.md'));
                return sessionLogs.sort((a, b) => b.name.localeCompare(a.name)); // ÊåâÊó∂Èó¥ÂÄíÂ∫è
            } catch (error) {
                if (error.message.includes('404')) {
                    return []; // logsÁõÆÂΩï‰∏çÂ≠òÂú®
                }
                throw error;
            }
        }

        // ÂàõÂª∫ËØ¶ÁªÜÁöÑÈîôËØØÊó•Âøó
        async function logErrorToGithub(filename, error, context = '') {
            const errorLogContent = `# ÈîôËØØÊó•Âøó - ${filename}\n\n## ÈîôËØØ‰ø°ÊÅØ\n${error.message}\n\n## ÈîôËØØÂ†ÜÊ†à\n\`\`\`\n${error.stack || 'No stack trace available'}\n\`\`\`\n\n## ‰∏ä‰∏ãÊñá‰ø°ÊÅØ\n${context}\n\n## Êó∂Èó¥\n${new Date().toISOString()}\n\n## ÈÖçÁΩÆ\n- Ê®°Âûã: ${config.gptModel}\n- Ê∫ê‰ªìÂ∫ì: ${config.sourceRepo}\n- ÁõÆÊ†á‰ªìÂ∫ì: ${config.targetRepo}`;
            
            try {
                const errorFileName = `error_${filename.replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}.md`;
                await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/errors/${errorFileName}`, 'PUT', {
                    message: `Add error log for ${filename}`,
                    content: btoa(errorLogContent)
                });
                
                addLog(`üìù ÈîôËØØËØ¶ÊÉÖÂ∑≤ËÆ∞ÂΩïÂà∞GitHub: logs/errors/${errorFileName}`, 'info');
            } catch (logError) {
                addLog(`‚ö†Ô∏è Êó†Ê≥ïËÆ∞ÂΩïÈîôËØØÊó•Âøó: ${logError.message}`, 'warning');
            }
        }

        // Â§ÑÁêÜÂçï‰∏™Á¨îËÆ∞Êñá‰ª∂
        async function processNoteFile(file) {
            addLog(`ÂºÄÂßãÂ§ÑÁêÜÊñá‰ª∂: ${file.name}`, 'info');
            
            try {
                // Ëé∑ÂèñÊñá‰ª∂ÂÜÖÂÆπ
                const fileData = await githubRequest(`/repos/${config.githubUser}/${config.sourceRepo}/contents/${file.path}`);
                const content = atob(fileData.content);
                
                // Ëß£ÊûêÁ¨îËÆ∞ÂÜÖÂÆπ
                const lines = content.split('\n');
                const numberedLines = lines.map((text, index) => ({
                    num: index + 1,
                    text: text
                }));

                // ÊûÑÂª∫GPTËØ∑Ê±Ç
                const protocol = `‰Ω†ÊòØÂ¢ûÈáèÁºñËæë Patch Â∫îÁî®Âô®Âä©ÊâãÔºå‰∏ìÈó®Áî®‰∫éÊï¥ÁêÜÂíå‰ºòÂåñÁ¨îËÆ∞ÂÜÖÂÆπ„ÄÇÊé•Êî∂Áî®Êà∑ÈúÄÊ±ÇÂíåÂ∏¶Ë°åÂè∑ÁöÑÁ¨îËÆ∞ÂÜÖÂÆπÔºåËøîÂõûÁ∫Ø JSON Êï∞ÁªÑÊìç‰ΩúÊåá‰ª§„ÄÇ

‰Ω†ÈúÄË¶ÅÂàÜÊûêÁ¨îËÆ∞ÂÜÖÂÆπÂπ∂ËøõË°å‰ª•‰∏ã‰ºòÂåñÔºö
1. ‰∏∫ÈáçË¶ÅÊ¶ÇÂøµÊ∑ªÂä†Ëß£ÈáäÊÄßÊ≥®Èáä
2. Êï¥ÁêÜÊ†ºÂºèÔºåÁ°Æ‰øùMarkdownËØ≠Ê≥ïÊ≠£Á°Æ
3. ‰∏∫Êó∂Èó¥Êà≥Ê†áÈ¢òÊ∑ªÂä†Êõ¥Ê∏ÖÊô∞ÁöÑÊèèËø∞
4. Ë°•ÂÖÖÁõ∏ÂÖ≥ÁöÑÊ†áÁ≠æÂíåÂàÜÁ±ª
5. ‰øÆÊ≠£ËØ≠Ê≥ïÈîôËØØÂíåÊîπÂñÑË°®Ëææ

Êìç‰ΩúÊåá‰ª§Ê†ºÂºèÔºö
{"op":"delete_line", "line":L} Âà†Èô§Á¨¨ L Ë°å
{"op":"delete_block", "start":S, "end":E} Âà†Èô§Á¨¨ S Ë°åËá≥Á¨¨ E Ë°å
{"op":"replace_line","line":L, "content":"ÊñáÊú¨"} ÊõøÊç¢Á¨¨ L Ë°å
{"op":"insert_line","line":L, "content":"ÊñáÊú¨"} Âú®Á¨¨ L Ë°å‰πãÂâçÊèíÂÖ•‰∏ÄË°å
{"op":"insert_block","line":L, "content":["Ë°å1","Ë°å2"]} Âú®Á¨¨ L Ë°å‰πãÂâçÊèíÂÖ•Â§öË°å
{"op":"edit_block","start":S, "end":E, "content":["Ë°å1","Ë°å2"]} Áî®Â§öË°åÊõøÊç¢Á¨¨ S Âà∞ E Ë°å

ËØ∑Áõ¥Êé•ËøîÂõûJSONÊ†ºÂºèÁöÑÊìç‰ΩúÊï∞ÁªÑÔºå‰∏çË¶ÅÂåÖÂê´‰ªª‰ΩïÂÖ∂‰ªñÊñáÂ≠ó„ÄÇ`;

                const codeLines = numberedLines.map(item => `${item.num}: ${item.text}`);
                const prompt = `${protocol}\n\nÁî®Êà∑ÈúÄÊ±ÇÔºö‰ºòÂåñÂíåÊï¥ÁêÜËøô‰∏™Á¨îËÆ∞Êñá‰ª∂ÔºåÊ∑ªÂä†ÂøÖË¶ÅÁöÑÊ≥®ÈáäÂíåÊ†ºÂºèÊîπËøõ\n\nÁõÆÊ†á‰ª£Á†ÅÔºö\n${codeLines.join('\n')}\n\nËØ∑‰∏•Ê†ºÊåâÁÖßÊ†ºÂºèËøîÂõûJSONÊìç‰ΩúÊï∞ÁªÑÔºö`;

                // Ë∞ÉÁî®OpenAI API
                const response = await openaiRequest([
                    { role: 'user', content: prompt }
                ], config.gptModel);

                const aiResponse = response.choices[0].message.content;
                let operations;
                
                try {
                    // Â∞ùËØïËß£ÊûêJSON
                    const parsed = JSON.parse(aiResponse);
                    operations = parsed.ops || parsed;
                } catch (parseError) {
                    // Â¶ÇÊûúÁõ¥Êé•Ëß£ÊûêÂ§±Ë¥•ÔºåÂ∞ùËØïÊèêÂèñJSONÈÉ®ÂàÜ
                    const jsonMatch = aiResponse.match(/\{[\s\S]*\}/);
                    if (jsonMatch) {
                        const parsed = JSON.parse(jsonMatch[0]);
                        operations = parsed.ops || parsed;
                    } else {
                        throw new Error('AIËøîÂõûÁöÑÊ†ºÂºèÊó†Ê≥ïËß£Êûê');
                    }
                }

                // Â∫îÁî®Êìç‰Ωú
                let modifiedLines = [...lines];
                
                // ÊåâË°åÂè∑ÂÄíÂ∫èÊéíÂ∫èÊìç‰ΩúÔºåÈÅøÂÖçË°åÂè∑ÂÅèÁßªÈóÆÈ¢ò
                operations.sort((a, b) => {
                    const lineA = a.line || a.start || 0;
                    const lineB = b.line || b.start || 0;
                    return lineB - lineA;
                });

                for (const op of operations) {
                    switch (op.op) {
                        case 'delete_line':
                            if (op.line > 0 && op.line <= modifiedLines.length) {
                                modifiedLines.splice(op.line - 1, 1);
                            }
                            break;
                        case 'delete_block':
                            if (op.start > 0 && op.end <= modifiedLines.length) {
                                modifiedLines.splice(op.start - 1, op.end - op.start + 1);
                            }
                            break;
                        case 'replace_line':
                            if (op.line > 0 && op.line <= modifiedLines.length) {
                                modifiedLines[op.line - 1] = op.content;
                            }
                            break;
                        case 'insert_line':
                            if (op.line > 0 && op.line <= modifiedLines.length + 1) {
                                modifiedLines.splice(op.line - 1, 0, op.content);
                            }
                            break;
                        case 'insert_block':
                            if (op.line > 0 && op.line <= modifiedLines.length + 1) {
                                modifiedLines.splice(op.line - 1, 0, ...op.content);
                            }
                            break;
                        case 'edit_block':
                            if (op.start > 0 && op.end <= modifiedLines.length) {
                                modifiedLines.splice(op.start - 1, op.end - op.start + 1, ...op.content);
                            }
                            break;
                    }
                }

                const modifiedContent = modifiedLines.join('\n');

                // ‰øùÂ≠òÂà∞ÁõÆÊ†á‰ªìÂ∫ì
                try {
                    // Ê£ÄÊü•ÁõÆÊ†áÊñá‰ª∂ÊòØÂê¶Â≠òÂú®
                    let targetSha = null;
                    try {
                        const existingFile = await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/${file.path}`);
                        targetSha = existingFile.sha;
                    } catch (e) {
                        // Êñá‰ª∂‰∏çÂ≠òÂú®ÔºåËøôÊòØÊ≠£Â∏∏ÁöÑ
                    }

                    await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/${file.path}`, 'PUT', {
                        message: `AIÊï¥ÁêÜÁ¨îËÆ∞: ${file.name}`,
                        content: btoa(modifiedContent),
                        sha: targetSha
                    });

                    // Êõ¥Êñ∞Â§ÑÁêÜÊó•Âøó
                    await updateProcessingLog(file.name, 'success', `Â∫îÁî®‰∫Ü${operations.length}‰∏™ÁºñËæëÊìç‰Ωú`);
                    
                    addLog(`‚úÖ ÊàêÂäüÂ§ÑÁêÜ: ${file.name}`, 'success');
                    stats.processed++;
                    
                } catch (saveError) {
                    await updateProcessingLog(file.name, 'failed', `‰øùÂ≠òÂ§±Ë¥•: ${saveError.message}`);
                    await logErrorToGithub(file.name, saveError, 'Êñá‰ª∂‰øùÂ≠òÈò∂ÊÆµ');
                    addLog(`‚ùå ‰øùÂ≠òÂ§±Ë¥•: ${file.name} - ${saveError.message}`, 'error');
                    stats.error++;
                }

            } catch (error) {
                await updateProcessingLog(file.name, 'error', `Â§ÑÁêÜÂ§±Ë¥•: ${error.message}`);
                await logErrorToGithub(file.name, error, 'Êñá‰ª∂Â§ÑÁêÜÈò∂ÊÆµ');
                addLog(`‚ùå Â§ÑÁêÜÂ§±Ë¥•: ${file.name} - ${error.message}`, 'error');
                stats.error++;
            }
        }

        // ‰∏ªÂ§ÑÁêÜÂáΩÊï∞
        async function startProcessing() {
            if (isProcessing) return;

            // È™åËØÅÈÖçÁΩÆ
            saveConfig();
            if (!config.githubToken || !config.openaiKey || !config.githubUser || !config.sourceRepo || !config.targetRepo) {
                addLog('‚ùå ËØ∑Â°´ÂÜôÂÆåÊï¥ÁöÑÈÖçÁΩÆ‰ø°ÊÅØ', 'error');
                return;
            }

            isProcessing = true;
            document.getElementById('processBtn').disabled = true;
            updateStatus('Ê≠£Âú®Â§ÑÁêÜ...', 'processing');
            
            // ÈáçÁΩÆÁªüËÆ°
            stats = { total: 0, processed: 0, skipped: 0, error: 0 };
            updateStats();

            try {
                addLog('üöÄ ÂºÄÂßãÊô∫ËÉΩÁ¨îËÆ∞Êï¥ÁêÜÊµÅÁ®ã', 'info');
                
                // Ëé∑ÂèñÂ§ÑÁêÜÊó•Âøó
                const processingLog = await getProcessingLog();
                processedLog = new Set(processingLog.map(line => {
                    const parts = line.split(' | ');
                    return parts[0]; // ÊèêÂèñÊñá‰ª∂ÂêçÈÉ®ÂàÜ
                }).filter(filename => filename && filename.trim()));
                
                addLog(`üìã Â∑≤ÊâæÂà∞ ${processedLog.size} ‰∏™Â∑≤Â§ÑÁêÜÊñá‰ª∂ËÆ∞ÂΩï`, 'info');

                // Ëé∑ÂèñÊ∫ê‰ªìÂ∫ìÁöÑÊâÄÊúâÊñá‰ª∂
                const repoContents = await githubRequest(`/repos/${config.githubUser}/${config.sourceRepo}/contents`);
                const mdFiles = [];

                // ÈÄíÂΩíËé∑ÂèñÊâÄÊúâ.mdÊñá‰ª∂
                async function collectMdFiles(contents, path = '') {
                    for (const item of contents) {
                        if (item.type === 'file' && item.name.endsWith('.md')) {
                            mdFiles.push({
                                name: item.name,
                                path: item.path,
                                url: item.url
                            });
                        } else if (item.type === 'dir') {
                            const subContents = await githubRequest(`/repos/${config.githubUser}/${config.sourceRepo}/contents/${item.path}`);
                            await collectMdFiles(subContents, item.path);
                        }
                    }
                }

                await collectMdFiles(repoContents);
                
                // ËøáÊª§Êú™Â§ÑÁêÜÁöÑÊñá‰ª∂
                const unprocessedFiles = mdFiles.filter(file => !processedLog.has(file.name));
                
                stats.total = mdFiles.length;
                stats.skipped = processedLog.size;
                updateStats();

                addLog(`üìÅ ÊâæÂà∞ ${stats.total} ‰∏™MarkdownÊñá‰ª∂ÔºåÂÖ∂‰∏≠ ${unprocessedFiles.length} ‰∏™ÂæÖÂ§ÑÁêÜ`, 'info');

                if (unprocessedFiles.length === 0) {
                    addLog('‚úÖ ÊâÄÊúâÊñá‰ª∂ÈÉΩÂ∑≤Â§ÑÁêÜÂÆåÊàê', 'success');
                    updateStatus('ÊâÄÊúâÊñá‰ª∂Â∑≤Â§ÑÁêÜ', 'ready');
                    return;
                }

                // Â§ÑÁêÜÊØè‰∏™Êñá‰ª∂
                for (let i = 0; i < unprocessedFiles.length; i++) {
                    const file = unprocessedFiles[i];
                    const progress = ((i + 1) / unprocessedFiles.length) * 100;
                    
                    updateProgress(progress);
                    updateStatus(`Â§ÑÁêÜ‰∏≠... (${i + 1}/${unprocessedFiles.length})`, 'processing');
                    
                    await processNoteFile(file);
                    updateStats();
                    
                    // Ê∑ªÂä†Âª∂ËøüÈÅøÂÖçAPIÈôêÂà∂
                    if (i < unprocessedFiles.length - 1) {
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }

                addLog('üéâ Êô∫ËÉΩÁ¨îËÆ∞Êï¥ÁêÜÂÆåÊàêÔºÅ', 'success');
                updateStatus('Â§ÑÁêÜÂÆåÊàê', 'ready');
                updateProgress(100);

                // ‰øùÂ≠ò‰ºöËØùÊó•ÂøóÂà∞GitHub
                addLog('üìù Ê≠£Âú®‰øùÂ≠ò‰ºöËØùÊó•ÂøóÂà∞GitHub...', 'info');
                await writeSessionLogToGithub();

            } catch (error) {
                addLog(`‚ùå Â§ÑÁêÜËøáÁ®ã‰∏≠ÂèëÁîüÈîôËØØ: ${error.message}`, 'error');
                await logErrorToGithub('main_process', error, '‰∏ªÂ§ÑÁêÜÊµÅÁ®ã');
                updateStatus('Â§ÑÁêÜÂá∫Èîô', 'error');
            } finally {
                isProcessing = false;
                document.getElementById('processBtn').disabled = false;
            }
        }

        // Â∑•ÂÖ∑ÂáΩÊï∞
        function validateConfig() {
            const required = ['githubToken', 'openaiKey', 'githubUser', 'sourceRepo', 'targetRepo'];
            for (const field of required) {
                if (!config[field] || config[field].trim() === '') {
                    return false;
                }
            }
            return true;
        }

        // ÈîôËØØÂ§ÑÁêÜ
        window.addEventListener('error', function(e) {
            addLog(`üí• Á≥ªÁªüÈîôËØØ: ${e.message}`, 'error');
        });

        // Ê∑ªÂä†ÈîÆÁõòÂø´Êç∑ÈîÆ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveConfig();
                        break;
                    case 'Enter':
                        if (!isProcessing) {
                            e.preventDefault();
                            startProcessing();
                        }
                        break;
                }
            }
        });

        // È°µÈù¢Á¶ªÂºÄÂâçÊèêÈÜí
        window.addEventListener('beforeunload', function(e) {
            if (isProcessing) {
                e.preventDefault();
                e.returnValue = 'Ê≠£Âú®Â§ÑÁêÜÊñá‰ª∂ÔºåÁ°ÆÂÆöË¶ÅÁ¶ªÂºÄÂêóÔºü';
                return e.returnValue;
            }
        });

        // Ëá™Âä®‰øùÂ≠òÈÖçÁΩÆÂäüËÉΩ
        function setupAutoSave() {
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        saveConfig();
                    }
                });
            });
        }

        // ÂàùÂßãÂåñËá™Âä®‰øùÂ≠ò
        setupAutoSave();

        // Ê∑ªÂä†ÊãñÊãΩÊñá‰ª∂ÊîØÊåÅÔºàÊú™Êù•Êâ©Â±ïÔºâ
        document.addEventListener('dragover', function(e) {
            e.preventDefault();
        });

        document.addEventListener('drop', function(e) {
            e.preventDefault();
            addLog('üöß ÊãñÊãΩ‰∏ä‰º†ÂäüËÉΩÂºÄÂèë‰∏≠...', 'warning');
        });

        // ‰∏ªÈ¢òÂàáÊç¢ÂäüËÉΩÔºàÂèØÈÄâÔºâ
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            addLog('üé® ‰∏ªÈ¢òÂ∑≤ÂàáÊç¢', 'info');
        }

        // ÊâπÈáèÊìç‰ΩúÊèêÁ§∫
        function showBatchTips() {
            addLog('üí° ÊèêÁ§∫ÔºöÂª∫ËÆÆÂú®ÁΩëÁªúÁ®≥ÂÆöÊó∂ËøõË°åÊâπÈáèÂ§ÑÁêÜ', 'info');
            addLog('üí° ÊèêÁ§∫ÔºöÂ§ßÈáèÊñá‰ª∂Â§ÑÁêÜÊó∂ËØ∑‰øùÊåÅÈ°µÈù¢ÂºÄÂêØ', 'info');
            addLog('üí° ÊèêÁ§∫ÔºöÂèØ‰ΩøÁî®Ctrl+SÂø´ÈÄü‰øùÂ≠òÈÖçÁΩÆ', 'info');
        }

        // ÂêØÂä®Êó∂ÊòæÁ§∫ÊèêÁ§∫
        setTimeout(showBatchTips, 2000);

        // APIÈÖçÈ¢ùÊ£ÄÊü•ÔºàÂèØÈÄâÂäüËÉΩÔºâ
        async function checkApiQuota() {
            try {
                // Ê£ÄÊü•GitHub APIÂâ©‰ΩôÈÖçÈ¢ù
                const rateLimit = await fetch('https://api.github.com/rate_limit', {
                    headers: {
                        'Authorization': `token ${config.githubToken}`
                    }
                });
                
                if (rateLimit.ok) {
                    const data = await rateLimit.json();
                    const remaining = data.rate.remaining;
                    addLog(`GitHub APIÂâ©‰ΩôÈÖçÈ¢ù: ${remaining}`, remaining > 100 ? 'info' : 'warning');
                }
            } catch (error) {
                // ÈùôÈªòÂ§ÑÁêÜÈÖçÈ¢ùÊ£ÄÊü•ÈîôËØØ
            }
        }

        // Â¢ûÂº∫ÁöÑÈîôËØØÈáçËØïÊú∫Âà∂
        async function retryOperation(operation, maxRetries = 3, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    return await operation();
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                    addLog(`‚ö†Ô∏è Êìç‰ΩúÂ§±Ë¥•Ôºå${delay/1000}ÁßíÂêéÈáçËØï... (${i+1}/${maxRetries})`, 'warning');
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2; // ÊåáÊï∞ÈÄÄÈÅø
                }
            }
        }

        // Êñá‰ª∂Â§ßÂ∞èÊ£ÄÊü•
        function checkFileSize(content, filename, maxSize = 1024 * 1024) { // 1MBÈôêÂà∂
            const size = new Blob([content]).size;
            if (size > maxSize) {
                addLog(`‚ö†Ô∏è Êñá‰ª∂ ${filename} ËøáÂ§ß (${(size/1024/1024).toFixed(2)}MB)ÔºåÂèØËÉΩÂΩ±ÂìçÂ§ÑÁêÜÊÄßËÉΩ`, 'warning');
                return false;
            }
            return true;
        }

        // ÂÜÖÂÆπË¥®ÈáèÊ£ÄÊü•
        function validateNoteContent(content, filename) {
            const lines = content.split('\n');
            const hasTimeHeader = lines.some(line => /^##\s+\d{4}\/\d{2}\/\d{2}/.test(line));
            
            if (!hasTimeHeader) {
                addLog(`‚ö†Ô∏è Êñá‰ª∂ ${filename} ÂèØËÉΩ‰∏çÊòØÊ†áÂáÜÁöÑÊó•ËÆ∞Ê†ºÂºè`, 'warning');
            }
            
            if (lines.length < 3) {
                addLog(`‚ö†Ô∏è Êñá‰ª∂ ${filename} ÂÜÖÂÆπËøáÂ∞ëÔºåÂèØËÉΩ‰∏çÈúÄË¶ÅAIÂ§ÑÁêÜ`, 'warning');
                return false;
            }
            
            return true;
        }

        // ÂØºÂá∫Â§ÑÁêÜÊä•Âëä
        function exportReport() {
            const report = {
                timestamp: new Date().toISOString(),
                config: {
                    model: config.gptModel,
                    sourceRepo: config.sourceRepo,
                    targetRepo: config.targetRepo
                },
                stats: stats,
                logs: Array.from(document.querySelectorAll('.log-entry')).map(el => el.textContent)
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `note-processing-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            addLog('üìä Â§ÑÁêÜÊä•ÂëäÂ∑≤ÂØºÂá∫', 'success');
        }

        // Êü•ÁúãÂéÜÂè≤‰ºöËØùÊó•Âøó
        async function viewHistoryLogs() {
            try {
                addLog('üîç Ê≠£Âú®Ëé∑ÂèñÂéÜÂè≤‰ºöËØùÊó•Âøó...', 'info');
                const sessionLogs = await getSessionLogs();
                
                if (sessionLogs.length === 0) {
                    addLog('üì≠ ÊöÇÊó†ÂéÜÂè≤‰ºöËØùÊó•Âøó', 'info');
                    return;
                }

                addLog(`üìö ÊâæÂà∞ ${sessionLogs.length} ‰∏™ÂéÜÂè≤‰ºöËØùÊó•Âøó:`, 'info');
                sessionLogs.slice(0, 10).forEach((log, index) => {
                    const sessionId = log.name.replace('session_', '').replace('.md', '');
                    const date = new Date(parseInt(sessionId)).toLocaleString();
                    addLog(`  ${index + 1}. ‰ºöËØù ${sessionId} - ${date}`, 'info');
                });

                if (sessionLogs.length > 10) {
                    addLog(`  ... ËøòÊúâ ${sessionLogs.length - 10} ‰∏™ÂéÜÂè≤‰ºöËØù`, 'info');
                }

                document.getElementById('sessionCount').textContent = sessionLogs.length;
            } catch (error) {
                addLog(`‚ùå Ëé∑ÂèñÂéÜÂè≤Êó•ÂøóÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ‰øùÂ≠òÂΩìÂâç‰ºöËØù
        async function saveCurrentSession() {
            if (Array.from(document.querySelectorAll('.log-entry')).length <= 1) {
                addLog('‚ö†Ô∏è ÂΩìÂâç‰ºöËØùÊó†ÂÜÖÂÆπÂèØ‰øùÂ≠ò', 'warning');
                return;
            }

            addLog('üíæ Ê≠£Âú®‰øùÂ≠òÂΩìÂâç‰ºöËØùÂà∞GitHub...', 'info');
            const success = await writeSessionLogToGithub();
            
            if (success) {
                document.getElementById('logStatus').textContent = '‚úÖ';
                // Êõ¥Êñ∞‰ºöËØùËÆ°Êï∞
                viewHistoryLogs();
            } else {
                document.getElementById('logStatus').textContent = '‚ùå';
            }
        }

        // Ê∏ÖÁ©∫ÂΩìÂâçÊó•Âøó
        function clearCurrentLogs() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div class="log-entry log-info">Êó•ÂøóÂ∑≤Ê∏ÖÁ©∫ÔºåÁ≠âÂæÖÊñ∞ÁöÑÊìç‰Ωú...</div>';
            addLog('üóëÔ∏è ÂΩìÂâçÊó•ÂøóÂ∑≤Ê∏ÖÁ©∫', 'info');
        }

        // Ê£ÄÊü•GitHubÊó•ÂøóÁõÆÂΩïÁä∂ÊÄÅ
        async function checkLogStatus() {
            try {
                const sessionLogs = await getSessionLogs();
                document.getElementById('sessionCount').textContent = sessionLogs.length;
                
                // Ê£ÄÊü•ÈîôËØØÊó•Âøó
                try {
                    const errorLogs = await githubRequest(`/repos/${config.githubUser}/${config.targetRepo}/contents/logs/errors`);
                    document.getElementById('errorCount').textContent = errorLogs.length;
                } catch (e) {
                    document.getElementById('errorCount').textContent = '0';
                }
                
                document.getElementById('logStatus').textContent = '‚úÖ';
            } catch (error) {
                document.getElementById('logStatus').textContent = '‚ùå';
            }
        }

        // ÂÆöÊúüÊ£ÄÊü•Êó•ÂøóÁä∂ÊÄÅ
        setInterval(() => {
            if (config.githubToken && config.githubUser && config.targetRepo) {
                checkLogStatus();
            }
        }, 30000); // ÊØè30ÁßíÊ£ÄÊü•‰∏ÄÊ¨°

        // Ê∑ªÂä†ÂØºÂá∫ÊåâÈíÆÂà∞ÁªüËÆ°Âå∫Âüü
        // document.querySelector('.stats-grid').insertAdjacentHTML('beforeend', `
        //     <div class="stat-card" style="cursor: pointer;" onclick="exportReport()">
        //         <span class="stat-number">üìä</span>
        //         <div class="stat-label">ÂØºÂá∫Êä•Âëä</div>
        //     </div>
        // `);
    </script>
</body>
</html>
